---
phase: 11-communication-splash
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/sp-communication-preferences/types.ts
  - src/components/sp-communication-preferences/utils/channels.ts
  - src/components/sp-communication-preferences/utils/icons.tsx
  - src/components/sp-communication-preferences/sp-communication-preferences.tsx
  - src/components/sp-communication-preferences/sp-communication-preferences.css
  - src/components/sp-communication-list/sp-communication-list.tsx
  - src/components/sp-communication-list/sp-communication-list.css
  - src/index.html
autonomous: true
requirements: [COMM-01, COMM-02, COMM-03, COMM-04, COMM-05]

must_haves:
  truths:
    - "sp-communication-preferences renders an icon-based button showing the current channel"
    - "Clicking the button opens a dropdown list of all 6 channels with icons and labels"
    - "Selecting a channel emits a preferenceChange event and updates the displayed channel"
    - "Selected channel shows a checkmark and highlight in the list"
    - "Compact mode and dark theme work via DWC variables"
  artifacts:
    - path: "src/components/sp-communication-preferences/types.ts"
      provides: "CommunicationChannel enum, ChannelInfo interface, PreferenceChangeEventDetail interface"
    - path: "src/components/sp-communication-preferences/utils/channels.ts"
      provides: "CHANNELS array with all 6 channel definitions, getChannelByType() lookup helper"
    - path: "src/components/sp-communication-preferences/utils/icons.tsx"
      provides: "SVG icon render functions for all 6 channels plus chevron-down and check"
    - path: "src/components/sp-communication-preferences/sp-communication-preferences.tsx"
      provides: "SpCommunicationPreferences Stencil component with button, sp-popover, and event wiring"
    - path: "src/components/sp-communication-list/sp-communication-list.tsx"
      provides: "SpCommunicationList Stencil component with channel items and selection state"
  key_links:
    - from: "src/components/sp-communication-preferences/sp-communication-preferences.tsx"
      to: "sp-popover"
      via: "embeds sp-popover in shadow DOM render, calls togglePopover/hidePopover"
      pattern: "popoverRef\\?\\.(toggle|hide)Popover"
    - from: "src/components/sp-communication-preferences/sp-communication-preferences.tsx"
      to: "src/components/sp-communication-list/sp-communication-list.tsx"
      via: "renders sp-communication-list inside sp-popover slot, handles preferenceChange event"
      pattern: "onPreferenceChange"
    - from: "src/components/sp-communication-list/sp-communication-list.tsx"
      to: "src/components/sp-communication-preferences/utils/channels.ts"
      via: "imports CHANNELS array for default channel list"
      pattern: "import.*CHANNELS.*from"
---

<objective>
Build sp-communication-preferences (selector button + dropdown list) following the exact sp-language-selector pattern.

Purpose: Port the communication channel selector as a Stencil web component with sp-popover dropdown, channel icons, selection state, and DWC theming. This mirrors the sp-language-selector architecture: a trigger button component that embeds sp-popover with a list component inside.

Output: Two Stencil components (sp-communication-preferences, sp-communication-list), shared types, channel data utility, SVG icon helpers, and demo section in index.html.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Pattern reference — follow these files exactly for component structure
@src/components/sp-language-selector/sp-language-selector.tsx
@src/components/sp-language-selector/sp-language-selector.css
@src/components/sp-language-selector/types.ts
@src/components/sp-language-selector/utils/languages.ts
@src/components/sp-language-selector/utils/icons.tsx
@src/components/sp-language-list/sp-language-list.tsx
@src/components/sp-language-list/sp-language-list.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared types, channel data utility, and SVG icon helpers</name>
  <files>
    src/components/sp-communication-preferences/types.ts
    src/components/sp-communication-preferences/utils/channels.ts
    src/components/sp-communication-preferences/utils/icons.tsx
  </files>
  <action>
Create 3 files following the sp-language-selector pattern:

**types.ts** — Define:
- `CommunicationChannel` string union type: `'APPLICATION' | 'EMAIL' | 'WHATSAPP' | 'PHONE' | 'MS_TEAMS' | 'GOOGLE_CHAT'` (COMM-02)
- `ChannelInfo` interface: `{ type: CommunicationChannel; label: string; }` — label is the human-readable display name (e.g., "Application", "Email", "WhatsApp", "Phone", "MS Teams", "Google Chat")
- `PreferenceChangeEventDetail` interface: `{ channel: CommunicationChannel; label: string; }` — emitted when a channel is selected (COMM-03)

**utils/channels.ts** — Define:
- `CHANNELS: ChannelInfo[]` array with all 6 channels in the order: APPLICATION, EMAIL, WHATSAPP, PHONE, MS_TEAMS, GOOGLE_CHAT
- `getChannelByType(type: CommunicationChannel): ChannelInfo | undefined` lookup helper (same pattern as getLanguageByCode)

**utils/icons.tsx** — Create Tabler-style SVG icon render functions. Each accepts an optional `size` parameter (default 18), returns JSX `<svg>` with `currentColor` stroke, `aria-hidden="true"`. Follow the exact pattern from sp-language-selector/utils/icons.tsx. Create these icons:
- `renderAppIcon()` — Tabler layout-grid icon (4-square grid representing an application)
- `renderEmailIcon()` — Tabler mail icon (envelope)
- `renderWhatsappIcon()` — Tabler brand-whatsapp icon (speech bubble with phone)
- `renderPhoneIcon()` — Tabler phone icon
- `renderMsTeamsIcon()` — Tabler brand-teams icon (grid with T)
- `renderGoogleChatIcon()` — Tabler message-circle icon (chat bubble)
- Also re-export `renderChevronDownIcon` and `renderCheckIcon` from sp-language-selector/utils/icons.tsx for convenience, OR import them directly in the components that need them. Prefer re-export to keep imports clean.
- `renderChannelIcon(channel: CommunicationChannel, size?: number)` — dispatcher function that returns the correct icon based on channel type. This centralizes the icon-to-channel mapping.
  </action>
  <verify>Run `npx stencil build` — no TypeScript errors. Verify the 3 files exist and exports are correct.</verify>
  <done>types.ts exports CommunicationChannel, ChannelInfo, PreferenceChangeEventDetail. channels.ts exports CHANNELS (6 items) and getChannelByType(). icons.tsx exports 6 channel icon functions plus renderChannelIcon dispatcher. Build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Build sp-communication-list dropdown component</name>
  <files>
    src/components/sp-communication-list/sp-communication-list.tsx
    src/components/sp-communication-list/sp-communication-list.css
  </files>
  <action>
Create sp-communication-list following the sp-language-list pattern exactly:

**sp-communication-list.tsx** — Stencil component with shadow: true, tag: 'sp-communication-list':
- Props:
  - `channels: ChannelInfo[]` — defaults to CHANNELS array (imported from ../sp-communication-preferences/utils/channels)
  - `selectedChannel: CommunicationChannel` — defaults to 'APPLICATION' (COMM-04)
  - `theme: 'light' | 'dark' | 'auto'` — defaults to 'auto' (COMM-05)
  - `compact: boolean` — defaults to false (COMM-05)
- Events:
  - `preferenceChange: EventEmitter<PreferenceChangeEventDetail>` — emitted on channel click (COMM-03)
- Render: A scrollable list (role="listbox", aria-label="Select communication channel") of channel items. Each item shows:
  - The channel icon via renderChannelIcon(channel.type, 18)
  - The channel label text
  - A checkmark icon (visibility: hidden unless selected) — same pattern as sp-language-list
- CSS parts: container, channel-item
- Host class for theme: same pattern as sp-language-list (theme-light, theme-dark)
- No sections/grouping needed (unlike language list which has preferred/all) — just a flat list of 6 channels

**sp-communication-list.css** — Follow sp-language-list.css structure:
- :host { display: block; }
- .channel-list container (no need for max-height/scroll since only 6 items, but keep min-width: 200px, padding)
- .channel-item with flex layout (icon + label + check), cursor pointer, hover background, transition
- .channel-item.selected with primary color and font-weight
- .check-icon with visibility hidden by default, visible when .selected
- .channel-icon flex-shrink: 0 container
- Compact mode with smaller padding and font
- Theme overrides (:host(.theme-light), :host(.theme-dark)) — same DWC token pattern as sp-language-list
  </action>
  <verify>Run `npx stencil build` — build passes, docs.json shows sp-communication-list with correct props and events.</verify>
  <done>sp-communication-list renders 6 channel items with icons and labels, selected channel shows checkmark, clicking emits preferenceChange event. Build passes cleanly.</done>
</task>

<task type="auto">
  <name>Task 3: Build sp-communication-preferences selector and wire dropdown via sp-popover</name>
  <files>
    src/components/sp-communication-preferences/sp-communication-preferences.tsx
    src/components/sp-communication-preferences/sp-communication-preferences.css
    src/index.html
  </files>
  <action>
Create sp-communication-preferences following the sp-language-selector pattern exactly:

**sp-communication-preferences.tsx** — Stencil component with shadow: true, tag: 'sp-communication-preferences':
- Props:
  - `selectedChannel: CommunicationChannel` — mutable, reflect: true, defaults to 'APPLICATION' (COMM-01)
  - `disabled: boolean` — defaults to false (COMM-05)
  - `compact: boolean` — defaults to false (COMM-05)
  - `theme: 'light' | 'dark' | 'auto'` — defaults to 'auto' (COMM-05)
- Events:
  - `preferenceChange: EventEmitter<PreferenceChangeEventDetail>` — re-emitted from sp-communication-list (COMM-03)
- State:
  - `isOpen: boolean` — tracks dropdown open state
- Private refs:
  - `popoverRef: HTMLSpPopoverElement | null` — for open/close control
- Handlers (arrow function class properties for stable references):
  - `handleButtonClick` — if disabled return; toggle popover (same as sp-language-selector)
  - `handleChannelSelected(event: CustomEvent<PreferenceChangeEventDetail>)` — update selectedChannel, hide popover, re-emit event
  - `handlePopoverOpen` — set isOpen = true
  - `handlePopoverClose` — set isOpen = false
- disconnectedCallback: cleanup (no timer needed here unlike language selector — no auto-hide)
- Render: Same structure as sp-language-selector:
  - Host with theme class
  - Button (part="trigger") with:
    - Channel icon via renderChannelIcon(this.selectedChannel, 16)
    - Channel label text (get from getChannelByType)
    - Chevron icon with open rotation class
    - aria-expanded, aria-haspopup="listbox", disabled attribute
    - CSS classes: selector-button, open, compact
  - sp-popover (ref, placement="bottom-start", close-on-click, close-on-escape, onPopoverOpen, onPopoverClose)
    - sp-communication-list inside with selectedChannel, compact, theme, onPreferenceChange props

**sp-communication-preferences.css** — Follow sp-language-selector.css exactly:
- :host { display: inline-block; position: relative; }
- .selector-button with inline-flex, DWC tokens for gap/padding/border/radius/background/color/font
- Hover, disabled, open states
- .channel-label for the text (similar to .lang-code but normal case, not uppercase)
- .chevron with rotation transition
- Compact mode
- Theme overrides (light/dark)

**src/index.html** — Add a demo section after the Voice Input Button section and before the OrgChart section:
- Section heading "Communication Preferences"
- Description paragraph
- 4 variants: default, compact, dark (on dark background), disabled
- Give them IDs: commPrefsDemo, commPrefsCompact, commPrefsDark, commPrefsDisabled
- Event log div (id="commPrefsEventLog")
- Script section to wire preferenceChange event listeners to the event log (same pattern as language selector demo)
  </action>
  <verify>Run `npx stencil build` — build passes. Open http://localhost:3333, verify the communication preferences demo renders with button showing APPLICATION icon and label, clicking opens dropdown with 6 channels.</verify>
  <done>sp-communication-preferences renders icon-based button with current channel, opens dropdown via sp-popover on click, selecting a channel updates the button and emits preferenceChange. Compact, disabled, and dark theme variants all render correctly in the demo page. All COMM-01 through COMM-05 requirements satisfied.</done>
</task>

</tasks>

<verification>
1. `npx stencil build` passes with no errors
2. docs.json contains sp-communication-preferences and sp-communication-list with correct props, events, and types
3. All 6 communication channels render with distinct icons and labels in the dropdown
4. Selected channel shows checkmark in list and updates the button icon + label
5. preferenceChange event fires with correct channel and label
6. Disabled, compact, and dark theme variants all work
</verification>

<success_criteria>
- sp-communication-preferences renders an icon-based button showing the current channel (COMM-01)
- Dropdown list shows all 6 channels with icons and labels (COMM-02)
- Selecting a channel emits preferenceChange event with channel type and label (COMM-03)
- Selected channel shows checkmark and highlight styling (COMM-04)
- Compact mode, disabled state, and dark theme via DWC variables all work (COMM-05)
- Build passes cleanly with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/11-communication-splash/11-01-SUMMARY.md`
</output>
