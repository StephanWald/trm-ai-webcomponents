---
phase: 01-foundation-infrastructure
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - .github/workflows/ci.yml
  - .github/workflows/release.yml
  - .changeset/config.json
  - .eslintrc.json
  - package.json
autonomous: true

must_haves:
  truths:
    - "GitHub Actions CI workflow runs build, lint, and tests on push/PR"
    - "Changesets configured for version management with changelog generation"
    - "Release workflow publishes to npm with provenance on GitHub Release creation"
    - "ESLint configured and npm run lint executes without config errors"
  artifacts:
    - path: ".github/workflows/ci.yml"
      provides: "CI pipeline running build + lint + test on every push/PR"
      contains: "npm run build"
    - path: ".github/workflows/release.yml"
      provides: "Release pipeline with Changesets and npm publish"
      contains: "changesets/action"
    - path: ".changeset/config.json"
      provides: "Changesets configuration for version management"
      contains: "changelog"
    - path: ".eslintrc.json"
      provides: "ESLint configuration for TypeScript/Stencil"
      contains: "parser"
  key_links:
    - from: ".github/workflows/ci.yml"
      to: "package.json"
      via: "npm scripts (build, lint, test)"
      pattern: "npm run (build|lint|test)"
    - from: ".github/workflows/release.yml"
      to: ".changeset/config.json"
      via: "changesets/action reads config"
      pattern: "changesets/action"
    - from: ".eslintrc.json"
      to: "stencil.config.ts"
      via: "TypeScript parser config"
      pattern: "typescript-eslint"
---

<objective>
Set up GitHub Actions CI/CD workflows (CI on push/PR, Release with Changesets + npm publish), Changesets version management, and ESLint configuration.

Purpose: Automated quality gates (CI) and release automation (Changesets + npm publish) ensure the project stays healthy and releases are repeatable. This is infrastructure that pays off from the very first PR.
Output: CI workflow, Release workflow, Changesets config, and ESLint setup.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-infrastructure/01-RESEARCH.md
@.planning/phases/01-foundation-infrastructure/01-CONTEXT.md
@.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GitHub Actions CI workflow and ESLint configuration</name>
  <files>
    .github/workflows/ci.yml
    .eslintrc.json
    package.json
  </files>
  <action>
    **Install ESLint dependencies:**
    ```bash
    npm install eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin --save-dev
    ```

    **.eslintrc.json** - Configure ESLint for Stencil/TypeScript:
    ```json
    {
      "parser": "@typescript-eslint/parser",
      "parserOptions": {
        "ecmaVersion": "latest",
        "sourceType": "module",
        "ecmaFeatures": { "jsx": true }
      },
      "plugins": ["@typescript-eslint"],
      "extends": [
        "eslint:recommended",
        "plugin:@typescript-eslint/recommended"
      ],
      "rules": {
        "@typescript-eslint/no-unused-vars": ["warn", { "argsIgnorePattern": "^_" }],
        "@typescript-eslint/explicit-function-return-type": "off",
        "@typescript-eslint/no-explicit-any": "warn"
      },
      "ignorePatterns": ["dist/", "dist-custom-elements/", "www/", "loader/", "node_modules/", "*.d.ts"]
    }
    ```

    **Update package.json scripts:**
    - `"lint": "eslint src --ext .ts,.tsx"` (replace any placeholder)

    **.github/workflows/ci.yml** - CI pipeline:
    ```yaml
    name: CI

    on:
      push:
        branches: [main, develop]
      pull_request:
        branches: [main, develop]

    permissions:
      contents: read

    jobs:
      build-and-test:
        runs-on: ubuntu-latest
        strategy:
          matrix:
            node-version: [20.x, 22.x]
        steps:
          - uses: actions/checkout@v4

          - name: Use Node.js ${{ matrix.node-version }}
            uses: actions/setup-node@v4
            with:
              node-version: ${{ matrix.node-version }}
              cache: 'npm'

          - run: npm ci
          - run: npm run lint
          - run: npm run build
          - run: npm test

          - name: Install Playwright Browsers
            run: npx playwright install --with-deps

          - name: Run E2E Tests
            run: npm run test.e2e
    ```

    Notes on the CI workflow:
    - Tests on both Node 20.x and 22.x for compatibility (NOT Node 24.x which is only needed for npm trusted publishing)
    - Branches: main and develop (git flow strategy from CONTEXT.md)
    - Caches npm for faster installs
    - Runs lint -> build -> test -> e2e in sequence (each depends on previous)
    - Playwright browsers installed separately in CI (not cached, installed fresh)

    After creating files, run `npm run lint` to verify ESLint config works (may have warnings, should not have config errors).

    **What to avoid:**
    - Do NOT use Node 24.x in CI matrix - it's only needed for npm trusted publishing, and introduces instability risk in CI
    - Do NOT add deploy steps to the CI workflow - that belongs in the release workflow
    - Do NOT make lint errors blocking initially - use "warn" for rules that might need tuning
    - Do NOT forget to include develop branch in triggers (git flow branching strategy)
  </action>
  <verify>
    1. `npm run lint` executes without config errors (warnings OK)
    2. `cat .github/workflows/ci.yml` contains npm run build, npm run lint, npm test
    3. `cat .eslintrc.json` contains @typescript-eslint/parser
    4. CI workflow triggers on push to main and develop, and on PRs to those branches
  </verify>
  <done>
    - ESLint configured for TypeScript/Stencil with sensible defaults
    - npm run lint runs successfully (may produce warnings on generated code, zero config errors)
    - CI workflow will run build + lint + test + e2e on every push/PR to main and develop
    - Node version matrix covers 20.x and 22.x
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure Changesets and Release workflow</name>
  <files>
    .changeset/config.json
    .github/workflows/release.yml
    package.json
  </files>
  <action>
    **Install Changesets:**
    ```bash
    npm install @changesets/cli --save-dev
    npx changeset init
    ```

    This creates `.changeset/` directory with `config.json` and a `README.md`.

    **Verify/update .changeset/config.json:**
    ```json
    {
      "$schema": "https://unpkg.com/@changesets/config@3.1.1/schema.json",
      "changelog": "@changesets/cli/changelog",
      "commit": false,
      "fixed": [],
      "linked": [],
      "access": "public",
      "baseBranch": "main",
      "updateInternalDependencies": "patch",
      "ignore": []
    }
    ```
    Key settings:
    - `"access": "public"` - Scoped package (@skillspilot/webcomponents) needs public access
    - `"baseBranch": "main"` - Changesets compares against main branch
    - `"commit": false` - Don't auto-commit changeset version bumps

    **Update package.json scripts:**
    - `"version": "changeset version"` (bumps versions based on changesets)
    - `"release": "npm run build && changeset publish"` (build + publish)
    - `"changeset": "changeset"` (convenience alias)

    **.github/workflows/release.yml** - Release pipeline:
    ```yaml
    name: Release

    on:
      push:
        branches:
          - main

    permissions:
      contents: write
      pull-requests: write
      id-token: write

    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}

    jobs:
      release:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v4
            with:
              fetch-depth: 0

          - uses: actions/setup-node@v4
            with:
              node-version: '24.x'
              registry-url: 'https://registry.npmjs.org'

          - run: npm ci
          - run: npm run build
          - run: npm test

          - name: Create Release Pull Request or Publish
            uses: changesets/action@v1
            with:
              publish: npm run release
              version: npm run version
              title: 'chore: version packages'
              commit: 'chore: version packages'
            env:
              GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
    ```

    Notes on the release workflow:
    - Uses Node 24.x specifically for npm trusted publishing (npm 11.5.1+ requirement from RESEARCH.md)
    - `id-token: write` permission for npm provenance
    - `fetch-depth: 0` for full git history (Changesets needs this)
    - Concurrency group prevents parallel release runs
    - changesets/action auto-creates version bump PRs OR publishes when changesets are consumed
    - NPM_TOKEN secret will need to be configured in GitHub repo settings (user_setup would handle this but repo doesn't exist yet)

    After creating files, verify changeset init worked:
    ```bash
    cat .changeset/config.json
    ls .changeset/README.md
    ```

    **What to avoid:**
    - Do NOT use `"access": "restricted"` - scoped packages default to restricted, we need public
    - Do NOT set `"commit": true` - let the PR workflow handle commits
    - Do NOT forget `fetch-depth: 0` in release workflow - Changesets needs full history
    - Do NOT use `--provenance` flag manually - npm trusted publishing handles this automatically with id-token permission
  </action>
  <verify>
    1. `.changeset/config.json` exists with `"access": "public"` and `"baseBranch": "main"`
    2. `.changeset/README.md` exists (created by changeset init)
    3. `cat .github/workflows/release.yml` contains changesets/action@v1
    4. `cat package.json | grep '"version"'` shows changeset version script (check scripts section, not the version field)
    5. `cat package.json | grep '"release"'` shows build + changeset publish
    6. `npx changeset status` runs without errors (should report "No changesets found")
  </verify>
  <done>
    - Changesets initialized with public access and main as base branch
    - Release workflow configured with Changesets action, npm trusted publishing, Node 24.x
    - package.json has version, release, and changeset scripts
    - `npx changeset status` works and reports no pending changesets
    - CI and Release workflows are separate concerns (CI validates, Release publishes)
  </done>
</task>

</tasks>

<verification>
1. `npm run lint` runs without config errors
2. `npx changeset status` reports cleanly (no errors)
3. `.github/workflows/ci.yml` exists with build + lint + test steps
4. `.github/workflows/release.yml` exists with changesets/action
5. `.changeset/config.json` has public access
6. All npm scripts work: lint, version, release (release would fail without npm auth, but script exists)
</verification>

<success_criteria>
- CI workflow ready to run build + lint + tests on every push/PR
- Release workflow ready to create version PRs and publish to npm
- Changesets configured for public scoped package
- ESLint configured for TypeScript/Stencil codebase
- All workflows follow git flow branching (main + develop)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-03-SUMMARY.md`
</output>
