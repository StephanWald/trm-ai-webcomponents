---
phase: 01-foundation-infrastructure
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/global/dwc-theme.css
  - src/components/sp-example/sp-example.tsx
  - src/components/sp-example/sp-example.css
  - src/components/sp-example/sp-example.spec.ts
  - src/components/sp-example/sp-example.e2e.ts
  - playwright.config.ts
  - src/index.html
autonomous: true

must_haves:
  truths:
    - "sp-example renders with sensible visual defaults when no DWC theme is loaded"
    - "sp-example consumes --dwc-* CSS custom properties when DWC theme is present"
    - "sp-example supports light/dark mode via theme attribute override"
    - "sp-example exposes ::part() selectors for structural styling"
    - "npm test passes with spec tests for sp-example"
  artifacts:
    - path: "src/global/dwc-theme.css"
      provides: "DWC token mappings with fallback defaults"
      contains: "--dwc-color"
    - path: "src/components/sp-example/sp-example.tsx"
      provides: "Test component consuming DWC tokens"
      contains: "@Component"
    - path: "src/components/sp-example/sp-example.css"
      provides: "Component styles with DWC token consumption and theme overrides"
      contains: "var(--dwc-"
    - path: "src/components/sp-example/sp-example.spec.ts"
      provides: "Unit tests for sp-example component"
      contains: "newSpecPage"
    - path: "playwright.config.ts"
      provides: "Playwright E2E test configuration"
      contains: "createConfig"
  key_links:
    - from: "src/components/sp-example/sp-example.css"
      to: "src/global/dwc-theme.css"
      via: "CSS custom property consumption"
      pattern: "var\\(--dwc-"
    - from: "src/components/sp-example/sp-example.tsx"
      to: "sp-example.css"
      via: "styleUrl in @Component decorator"
      pattern: "styleUrl.*sp-example\\.css"
    - from: "stencil.config.ts"
      to: "src/global/dwc-theme.css"
      via: "globalStyle config"
      pattern: "globalStyle.*dwc-theme"
---

<objective>
Create the DWC theming system with CSS custom properties and fallback defaults, build the sp-example test component that validates the entire theming + build + test pipeline, and configure both Stencil spec tests and Playwright E2E tests.

Purpose: The sp-example component proves that theming, build outputs, and testing all work end-to-end before any real component work begins. It establishes the patterns every future component will follow.
Output: Working sp-example component with DWC theming, unit tests, E2E tests, and Playwright configuration.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-infrastructure/01-RESEARCH.md
@.planning/phases/01-foundation-infrastructure/01-CONTEXT.md
@.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement DWC theming system and sp-example component</name>
  <files>
    src/global/dwc-theme.css
    src/components/sp-example/sp-example.tsx
    src/components/sp-example/sp-example.css
    src/index.html
  </files>
  <action>
    **src/global/dwc-theme.css** - Populate with DWC token mappings. Define CSS custom properties at `:root` that map DWC tokens to component-consumable values with sensible fallback defaults:

    Core tokens to map (at minimum):
    - Colors: --dwc-color-primary (fallback #0066cc), --dwc-color-surface (fallback #ffffff), --dwc-color-on-surface / --dwc-color-text (fallback #1a1a1a), --dwc-color-primary-text (fallback #ffffff), --dwc-color-border (fallback #e0e0e0), --dwc-color-danger (fallback #dc3545), --dwc-color-success (fallback #28a745)
    - Typography: --dwc-font-family (fallback system-ui, -apple-system, sans-serif), --dwc-font-size-base (fallback 1rem), --dwc-font-size-sm (fallback 0.875rem), --dwc-font-size-lg (fallback 1.25rem)
    - Spacing: --dwc-spacing-xs (fallback 0.25rem), --dwc-spacing-sm (fallback 0.5rem), --dwc-spacing-md (fallback 1rem), --dwc-spacing-lg (fallback 1.5rem), --dwc-spacing-xl (fallback 2rem)
    - Border radius: --dwc-border-radius (fallback 4px)
    - Shadows: --dwc-shadow-sm, --dwc-shadow-md

    Each variable should use `var(--dwc-external-token, fallback)` pattern so DWC tokens override when present but defaults look clean standalone.

    **src/components/sp-example/sp-example.tsx** - Create test component:
    - Tag: `sp-example`
    - Shadow DOM: true
    - Props:
      - `theme: 'light' | 'dark' | 'auto'` (default 'auto') - Component-level theme override for standalone use
      - `heading: string` (default 'Example Component') - Configurable heading text
    - Render: A card-like container with heading, description paragraph, and a themed button. Apply `theme-light` or `theme-dark` CSS class on host when theme prop is not 'auto'.
    - Expose `::part()` on: container, heading, content, button
    - Event: Emit `sp-example-click` custom event when button is clicked

    **src/components/sp-example/sp-example.css** - Component styles:
    - `:host` block consuming DWC tokens: display block, background var(--dwc-color-surface), color var(--dwc-color-text), font-family var(--dwc-font-family), padding var(--dwc-spacing-md), border-radius var(--dwc-border-radius), border using --dwc-color-border
    - `:host(.theme-dark)` overrides: dark background (#1e1e2e), light text (#e0e0e0), adjusted border color
    - `:host(.theme-light)` overrides: explicit light values
    - Button styles using --dwc-color-primary for background, --dwc-color-primary-text for text
    - Hover/focus states on the button
    - Use `part` attribute on rendered elements matching the ::part() selectors

    **src/index.html** - Update the dev server HTML:
    - Add a `<sp-example></sp-example>` instance with default props
    - Add a `<sp-example theme="dark" heading="Dark Mode"></sp-example>` instance
    - Add minimal page styling to show both variants side by side

    After implementation, run `npm run build` to verify the component compiles correctly with both output targets.

    **What to avoid:**
    - Do NOT use `@Prop({ mutable: true })` on the theme prop - it should be set by consumer, not mutated internally
    - Do NOT hardcode colors in the component CSS without going through CSS custom properties
    - Do NOT forget `shadow: true` in the @Component decorator - all components use shadow DOM
    - Do NOT use `customElements.define()` manually - Stencil handles registration
  </action>
  <verify>
    1. `npm run build` completes without errors
    2. `cat src/global/dwc-theme.css` contains --dwc-color-primary with fallback
    3. `cat src/components/sp-example/sp-example.tsx` contains @Component, @Prop, theme, heading
    4. `cat src/components/sp-example/sp-example.css` contains var(--dwc-color and :host(.theme-dark)
    5. `npm run start` serves dev page showing both light and dark sp-example instances (visual check via process output)
  </verify>
  <done>
    - DWC theme CSS defines core tokens (colors, typography, spacing) with fallback defaults
    - sp-example component renders a themed card with heading, content, and button
    - Component respects DWC tokens when present, falls back to defaults when absent
    - theme="dark" and theme="light" attribute overrides work
    - ::part() selectors exposed on container, heading, content, button
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure testing and write sp-example tests</name>
  <files>
    src/components/sp-example/sp-example.spec.ts
    src/components/sp-example/sp-example.e2e.ts
    playwright.config.ts
    package.json
  </files>
  <action>
    **Install testing dependencies:**
    ```bash
    npm install @stencil/playwright @playwright/test --save-dev
    npx playwright install
    ```

    **playwright.config.ts** - Create Playwright config for Stencil:
    ```typescript
    import { createConfig } from '@stencil/playwright';

    export default createConfig();
    ```

    **Update package.json scripts:**
    - `"test": "stencil test --spec"` (should already exist from Plan 01)
    - `"test.e2e": "playwright test"` (Playwright E2E runner)
    - `"test.all": "npm run test && npm run test.e2e"` (run both)

    **src/components/sp-example/sp-example.spec.ts** - Stencil unit tests using `newSpecPage`:
    - Test: renders with default props (heading = 'Example Component')
    - Test: renders with custom heading prop
    - Test: applies theme-dark class when theme="dark"
    - Test: applies theme-light class when theme="light"
    - Test: no theme class applied when theme="auto" (default)
    - Test: emits sp-example-click event when button is clicked
    - Test: exposes expected CSS parts (container, heading, content, button)

    **src/components/sp-example/sp-example.e2e.ts** - Playwright E2E tests:
    - Test: component renders and is visible on page
    - Test: heading text matches prop value
    - Test: dark theme variant has correct CSS class
    - Test: component responds to theme attribute change
    - Test: click event fires when button is clicked

    After writing tests, run `npm test` for spec tests and `npx playwright test` for E2E tests.

    **What to avoid:**
    - Do NOT use the old Stencil E2E test runner (newE2EPage) - use Playwright adapter instead
    - Do NOT skip installing Playwright browsers (`npx playwright install` is required)
    - Do NOT test implementation details - test observable behavior (rendered output, events, classes)
  </action>
  <verify>
    1. `npm test` passes all spec tests (exit code 0)
    2. `npx playwright test` passes all E2E tests (exit code 0)
    3. `cat src/components/sp-example/sp-example.spec.ts` contains test cases for default render, theme prop, events
    4. `cat playwright.config.ts` contains createConfig from @stencil/playwright
  </verify>
  <done>
    - Stencil spec tests pass: default render, custom heading, theme classes, click event, CSS parts
    - Playwright E2E tests pass: visibility, heading text, dark theme class, attribute change, click event
    - Test runner configured in package.json with test, test.e2e, and test.all scripts
    - All tests run without flakiness on clean build
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds with sp-example component in both output directories
2. `npm test` passes all spec tests for sp-example
3. `npx playwright test` passes all E2E tests for sp-example
4. sp-example renders with default styling when no DWC theme loaded (clean neutral look)
5. sp-example consumes DWC CSS custom properties when they are set on :root
6. theme="dark" attribute produces dark-themed rendering
</verification>

<success_criteria>
- DWC theming system established with fallback defaults
- sp-example component validates: theming works, build works, tests work
- Both spec and E2E test suites passing
- Pattern established for all future components (theming, testing, ::part() exposure)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-02-SUMMARY.md`
</output>
