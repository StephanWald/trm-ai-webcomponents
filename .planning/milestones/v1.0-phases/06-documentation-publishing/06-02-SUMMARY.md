---
phase: 06-documentation-publishing
plan: 02
subsystem: ci-cd
tags: [github-actions, npm-provenance, github-pages, docusaurus, changesets]
dependency-graph:
  requires: []
  provides: [docs-deploy-workflow, npm-provenance-publishing]
  affects: [release-workflow, github-pages-deployment]
tech-stack:
  added: []
  patterns: [changesets-provenance, github-pages-native-deploy, stencil-first-build-ordering]
key-files:
  created:
    - .github/workflows/docs-deploy.yml
  modified:
    - .github/workflows/release.yml
decisions:
  - "NPM_CONFIG_PROVENANCE env var added to changesets action step (not npm publish flag) for OIDC-based provenance attestation"
  - "createGithubReleases: true added so changesets action auto-creates GitHub Release entries when publishing"
  - "docs-deploy.yml uses actions/upload-pages-artifact@v3 + actions/deploy-pages@v4 (GitHub-native, no gh-pages branch)"
  - "Stencil build runs before Docusaurus build in CI to ensure docs.json exists when Docusaurus imports it"
  - "Node 20 used in docs-deploy.yml (docs build) vs Node 24 in release.yml (publishing) - appropriate for each use case"
metrics:
  duration: 1 min
  completed: 2026-02-21
  tasks: 2
  files: 2
---

# Phase 06 Plan 02: CI/CD Workflows Summary

**One-liner:** Updated release workflow with npm OIDC provenance via changesets action; new docs-deploy.yml builds Stencil then Docusaurus and deploys to GitHub Pages via native actions/deploy-pages@v4.

## What Was Built

### Task 1: release.yml — npm provenance support (commit: 999e0ad)

Added two lines to the existing `changesets/action@v1` step:

- `createGithubReleases: true` in the `with` block — enables automatic GitHub Release creation when changesets publishes
- `NPM_CONFIG_PROVENANCE: 'true'` in the `env` block — enables OIDC-based npm provenance attestation

The `id-token: write` permission was already present in the workflow's top-level `permissions` block (confirmed during research). No other changes were made to the workflow structure, trigger, build steps, or node version.

### Task 2: docs-deploy.yml — GitHub Pages deployment (commit: ba2e0c5)

Created `.github/workflows/docs-deploy.yml` with:

- **Trigger:** push to `master` branch + `workflow_dispatch` (manual trigger)
- **Permissions:** `contents: read`, `pages: write`, `id-token: write`
- **Concurrency:** group `pages`, `cancel-in-progress: false` (prevents deployment race conditions)
- **Build job:** checkout → setup Node 20 → `npm ci` (root) → `npm run build` (Stencil, generates docs.json) → `npm ci` (docs/) → `npm run build` (Docusaurus) → `upload-pages-artifact@v3` with `docs/build`
- **Deploy job:** `needs: build` → `deploy-pages@v4` with github-pages environment and URL output

Build ordering ensures `docs.json` (generated by Stencil) exists before Docusaurus attempts to import it. This workflow will not succeed until Plan 03 scaffolds the Docusaurus site, but the workflow itself is correct and ready.

## Deviations from Plan

None - plan executed exactly as written.

## Success Criteria Verification

- [x] `release.yml` updated with `NPM_CONFIG_PROVENANCE: 'true'` in changesets action env (INFRA-07)
- [x] `docs-deploy.yml` created with build and deploy jobs (DOCS-01 infrastructure)
- [x] Both YAML files syntactically valid (node -e readFileSync passes)
- [x] `docs-deploy.yml` runs Stencil build (line 34) before Docusaurus build (line 41)
- [x] No changes to `ci.yml`
- [x] Correct GitHub Actions versions: checkout@v4, upload-pages-artifact@v3, deploy-pages@v4

## Self-Check: PASSED

| Item | Status |
|------|--------|
| `.github/workflows/release.yml` exists | FOUND |
| `.github/workflows/docs-deploy.yml` created | FOUND |
| Task 1 commit 999e0ad | FOUND |
| Task 2 commit ba2e0c5 | FOUND |
