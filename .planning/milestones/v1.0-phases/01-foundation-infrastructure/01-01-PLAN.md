---
phase: 01-foundation-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - stencil.config.ts
  - tsconfig.json
  - src/index.html
  - src/index.ts
  - src/components.d.ts
  - .gitignore
  - .editorconfig
  - .prettierrc
autonomous: true

must_haves:
  truths:
    - "npm run build produces both dist/ and dist-custom-elements/ directories"
    - "npm run build completes without errors"
    - "package.json declares @skillspilot/webcomponents with correct exports for CDN and bundler consumption"
    - "Peer dependencies (marked, DOMPurify, Prism.js, Turndown) declared as optional, not bundled"
  artifacts:
    - path: "stencil.config.ts"
      provides: "Dual output target configuration (dist + dist-custom-elements + www)"
      contains: "dist-custom-elements"
    - path: "package.json"
      provides: "Package manifest with exports, peer deps, scripts"
      contains: "@skillspilot/webcomponents"
    - path: "src/index.html"
      provides: "Dev server HTML entry point"
      contains: "skillspilot"
  key_links:
    - from: "stencil.config.ts"
      to: "dist/"
      via: "dist output target"
      pattern: "type.*dist"
    - from: "stencil.config.ts"
      to: "dist-custom-elements/"
      via: "custom elements output target"
      pattern: "dist-custom-elements"
    - from: "package.json"
      to: "stencil.config.ts"
      via: "build script invokes stencil"
      pattern: "stencil build"
---

<objective>
Initialize the Stencil.js project with dual output targets, package.json configured for npm publishing as @skillspilot/webcomponents, optional peer dependencies for heavy libraries, and proper TypeScript configuration.

Purpose: This is the foundational skeleton that all subsequent plans depend on. Without a working build pipeline and proper package configuration, no component work can begin.
Output: A buildable Stencil project with dual output (dist + dist-custom-elements), correct npm package exports, and optional peer dependencies declared.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-infrastructure/01-RESEARCH.md
@.planning/phases/01-foundation-infrastructure/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Stencil project with dual output targets</name>
  <files>
    package.json
    stencil.config.ts
    tsconfig.json
    src/index.html
    src/index.ts
    src/components.d.ts
    .gitignore
    .editorconfig
    .prettierrc
  </files>
  <action>
    Initialize a new Stencil component library project. Use `npm init stencil` and select the "component" starter, OR manually scaffold the equivalent structure if the CLI starter doesn't match the required configuration.

    **stencil.config.ts** - Configure with these exact output targets:
    ```typescript
    import { Config } from '@stencil/core';

    export const config: Config = {
      namespace: 'skillspilot',
      globalStyle: 'src/global/dwc-theme.css',
      outputTargets: [
        {
          type: 'dist',
          esmLoaderPath: '../loader',
          isPrimaryPackageOutputTarget: true,
        },
        {
          type: 'dist-custom-elements',
          customElementsExportBehavior: 'auto-define-custom-elements',
          externalRuntime: false,
          generateTypeDeclarations: true,
        },
        {
          type: 'www',
          copy: [{ src: '**/*.html' }, { src: '**/*.css' }],
          serviceWorker: null,
        },
      ],
    };
    ```

    **package.json** - Must include:
    - `"name": "@skillspilot/webcomponents"`
    - `"version": "0.0.1"` (pre-release until v1)
    - Correct `main`, `module`, `es2015`, `es2017`, `types`, `unpkg`, `collection`, `collection:main` fields pointing to dist/ outputs (see RESEARCH.md Pattern 4 for exact values)
    - `"exports"` field with conditions for ".", "./loader", and "./dist/custom-elements"
    - `"files"` array including dist/, loader/, and types
    - Scripts: `build` (stencil build), `start` (stencil build --dev --watch --serve), `test` (stencil test --spec), `test.e2e` (placeholder for Playwright), `generate` (stencil generate), `lint` (placeholder eslint command)
    - Optional peer dependencies:
      ```json
      "peerDependencies": {
        "marked": "^12.0.0 || ^13.0.0",
        "dompurify": "^3.0.0",
        "prismjs": "^1.29.0",
        "turndown": "^7.1.0"
      },
      "peerDependenciesMeta": {
        "marked": { "optional": true },
        "dompurify": { "optional": true },
        "prismjs": { "optional": true },
        "turndown": { "optional": true }
      }
      ```

    **src/index.html** - Dev server entry page with:
    - Script tag loading the built components: `<script type="module" src="/build/skillspilot.esm.js"></script>`
    - Link to global CSS: `<link rel="stylesheet" href="/build/skillspilot.css">`
    - Placeholder `<sp-example></sp-example>` tag (component created in Plan 02)

    **src/global/dwc-theme.css** - Create as EMPTY placeholder file (Plan 02 fills in the theming). Must exist because stencil.config.ts references it via globalStyle.

    **.gitignore** - Include: node_modules/, dist/, dist-custom-elements/, www/, loader/, .stencil/, *.log

    **.editorconfig** and **.prettierrc** - Standard config for TypeScript projects (2-space indent, trailing newline, single quotes).

    **tsconfig.json** - Stencil generates this; ensure it extends @stencil/core compiler defaults.

    After creating all files, run `npm install` to install dependencies, then run `npm run build` to verify the build produces both output directories.

    **What to avoid:**
    - Do NOT use `dist-custom-elements-bundle` (deprecated since Stencil v2.12.0)
    - Do NOT set `externalRuntime: true` on dist-custom-elements (we want bundled runtime for easier consumption)
    - Do NOT add framework wrappers (React, Angular, Vue) - vanilla web components only
    - Do NOT forget the `www` output target - Playwright E2E tests require it
  </action>
  <verify>
    1. `npm run build` completes without errors
    2. `ls dist/` shows built output files including skillspilot.esm.js
    3. `ls dist-custom-elements/` shows built output files
    4. `ls www/` shows built dev server output
    5. `cat package.json | grep '"name"'` shows `@skillspilot/webcomponents`
    6. `cat package.json | grep -A1 '"marked"'` shows peer dependency entry
    7. `cat package.json | grep '"peerDependenciesMeta"'` shows optional meta entries
    8. `cat stencil.config.ts | grep 'dist-custom-elements'` confirms dual target
  </verify>
  <done>
    - `npm run build` produces dist/, dist-custom-elements/, and www/ directories without errors
    - package.json name is @skillspilot/webcomponents with correct exports map
    - All four peer dependencies declared as optional in peerDependenciesMeta
    - stencil.config.ts has all three output targets (dist, dist-custom-elements, www)
    - src/global/dwc-theme.css exists (even if empty placeholder)
  </done>
</task>

</tasks>

<verification>
1. `npm run build` exits with code 0
2. Both `dist/` and `dist-custom-elements/` directories exist with JS output files
3. `www/` directory exists for dev server / Playwright
4. package.json exports field has entries for ".", "./loader", and "./dist/custom-elements"
5. No peer dependencies appear in node_modules (they are optional)
</verification>

<success_criteria>
- Build pipeline functional with dual output targets
- Package manifest correctly configured for npm publishing
- Peer dependencies declared but not installed/bundled
- Project ready for component development (Plan 02) and CI/CD setup (Plan 03)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md`
</output>
