---
phase: 08-walkthrough-parity
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/sp-walkthrough/sp-walkthrough.tsx
  - src/components/sp-walkthrough/sp-walkthrough.css
  - src/components/sp-walkthrough/sp-walkthrough.spec.ts
  - src/components/sp-walkthrough/sp-walkthrough.e2e.ts
  - src/components.d.ts
autonomous: true
requirements:
  - WALK-01
  - WALK-02
  - WALK-03
  - WALK-04
  - WALK-10
  - WALK-11

must_haves:
  truths:
    - "All control buttons display Tabler SVG icons instead of emoji characters"
    - "A visual progress bar shows current playback position and supports click-to-seek"
    - "Skip backward 10s and skip forward 10s buttons are present and functional"
    - "Restart button returns playback to beginning"
    - "Controls render in a single-row layout without a separate panel header"
    - "All colors and fonts use DWC CSS custom properties with sensible fallback defaults"
  artifacts:
    - path: "src/components/sp-walkthrough/sp-walkthrough.tsx"
      provides: "Tabler SVG icon functions, progress bar, skip/restart handlers, single-row controls layout"
      contains: "handleSkipBack|handleSkipForward|handleRestart|handleProgressClick|renderProgressBar"
    - path: "src/components/sp-walkthrough/sp-walkthrough.css"
      provides: "Single-row controls CSS, progress bar styling, DWC token usage"
      contains: "progress-bar|controls-row"
    - path: "src/components/sp-walkthrough/sp-walkthrough.spec.ts"
      provides: "Tests for new controls, icons, progress bar, skip/restart"
    - path: "src/components/sp-walkthrough/sp-walkthrough.e2e.ts"
      provides: "E2E tests for new controls interactions"
  key_links:
    - from: "sp-walkthrough.tsx renderControls()"
      to: "handleSkipBack/handleSkipForward/handleRestart"
      via: "onClick handlers on Tabler SVG icon buttons"
      pattern: "handleSkip(Back|Forward)|handleRestart"
    - from: "sp-walkthrough.tsx renderProgressBar()"
      to: "handleProgressClick"
      via: "onClick on progress bar div to seek"
      pattern: "handleProgressClick|currentTime.*duration"
---

<objective>
Replace all emoji-based controls with Tabler SVG icons, restructure the controls bar into a single-row layout without a separate panel header, add a visual progress bar with click-to-seek, add skip backward/forward 10s buttons, add a restart button, and ensure all colors/fonts use DWC CSS custom properties.

Purpose: Achieve controls visual parity with the original prototype ‚Äî icons, layout, and playback controls must match the expected single-row design with Tabler iconography.
Output: sp-walkthrough renders with Tabler SVG icons, single-row controls, progress bar, skip/restart buttons, and full DWC theming.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-walkthrough-parity/08-CONTEXT.md

Key reference files:
@src/components/sp-walkthrough/sp-walkthrough.tsx
@src/components/sp-walkthrough/sp-walkthrough.css
@src/components/sp-walkthrough/types/walkthrough.types.ts
@src/components/sp-org-chart/sp-org-chart.tsx (inline SVG icon pattern reference)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace emoji controls with Tabler SVG icons, restructure to single-row layout, add progress bar and skip/restart</name>
  <files>
    src/components/sp-walkthrough/sp-walkthrough.tsx
    src/components/sp-walkthrough/sp-walkthrough.css
    src/components.d.ts
  </files>
  <action>
    **Icon replacement (WALK-01):**
    Replace ALL emoji characters in the component with inline Tabler SVG icons. Follow the sp-org-chart pattern: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">`. Create a private helper method or inline SVGs for each icon needed:
    - Play: `<polygon points="5 3 19 12 5 21 5 3" fill="currentColor" stroke="none"/>` (Tabler player-play filled)
    - Pause: `<rect x="6" y="4" width="4" height="16" fill="currentColor" stroke="none"/><rect x="14" y="4" width="4" height="16" fill="currentColor" stroke="none"/>` (Tabler player-pause filled)
    - Skip back 10: Tabler rewind-backward-10 path
    - Skip forward 10: Tabler rewind-forward-10 path
    - Restart: Tabler refresh/player-skip-back path (circle arrow)
    - Close (X): `<path d="M18 6L6 18M6 6l12 12"/>` (same as org-chart unlink)
    - Volume: Tabler volume path
    - Volume off: Tabler volume-off path
    - Scene list: Tabler list path
    - Subtitles/CC: Tabler subtitles path (or message/badge icon)
    - Chevron-left/right: used if prev/next scene buttons kept
    - Author mode icons: tool, pointer, plus, check, pencil, trash (for author toolbar)

    Ensure all SVGs use `width="18" height="18"` for control buttons (small inline size).

    **Controls layout rewrite (WALK-10):**
    Remove the separate `.panel-header` section from the render output. Merge the panel title and close button into the controls row. The controls should be a single horizontal row containing (left to right):
    - Play/pause button
    - Skip back 10s button
    - Skip forward 10s button
    - Restart button
    - Progress bar (takes remaining space, flex-grow)
    - Time display (currentTime / duration in mm:ss format)
    - Volume button (toggles mute or opens volume popup ‚Äî popup handled in Plan 02)
    - Captions toggle button
    - Scene list button (opens popup ‚Äî popup handled in Plan 02; for now render as a button that triggers the existing scene select behavior)
    - Close button

    The walkthrough-panel should no longer have a `.panel-header` + `.panel-content` split. Instead use a single content area with the controls row at the top (or bottom, per prototype ‚Äî use top).

    **Progress bar (WALK-02):**
    Add a `renderProgressBar()` method that renders a div-based progress bar:
    - Container div `.progress-bar` with background track color
    - Inner div `.progress-bar__fill` with width set to `(currentTime / duration) * 100%`
    - onClick handler `handleProgressClick(ev)` that calculates click position as fraction of bar width, then seeks to `fraction * duration`
    - Progress bar should be visible only when `videoSrc` is set (not manual mode)

    **Skip buttons (WALK-03):**
    Add `handleSkipBack` and `handleSkipForward` methods:
    - `handleSkipBack`: seeks to `Math.max(0, currentTime - 10)` on both YouTube and standard video
    - `handleSkipForward`: seeks to `Math.min(duration, currentTime + 10)` on both YouTube and standard video

    **Restart button (WALK-04):**
    The existing `restart()` method already handles restart. Add a restart button in the controls row that calls `this.restart()`.

    **DWC theming audit (WALK-11):**
    Ensure every color, font, spacing, shadow, and border-radius uses `var(--dwc-*, fallback)` pattern. Audit the CSS file: any hardcoded hex color in the base styles (not theme overrides) must use a DWC variable. The existing CSS already uses DWC tokens extensively ‚Äî verify completeness and add any missing tokens for new controls elements (progress bar, new buttons).

    **CSS updates:**
    - Remove `.panel-header` styles (or repurpose them)
    - Add `.controls-row` ‚Äî single horizontal flex row, `align-items: center`, `gap` spacing
    - Add `.progress-bar` ‚Äî height 4px, background track, border-radius, cursor pointer, flex-grow
    - Add `.progress-bar__fill` ‚Äî height 100%, background primary color, transition for smooth updates
    - Add `.time-display` ‚Äî small monospace font for mm:ss
    - Add `.icon` base class for SVG icons ‚Äî `width: 18px; height: 18px; flex-shrink: 0`
    - Ensure control buttons use DWC tokens for background, border, hover states
    - Update dark theme overrides for new elements

    **Format helper:**
    Add a `formatTime(seconds: number): string` utility method that returns `mm:ss` format.
  </action>
  <verify>
    Run `npx stencil build` ‚Äî build completes without errors.
    Visually verify (via test HTML or E2E) that controls render with SVG icons, progress bar is visible, skip/restart buttons are present.
    No emoji characters remain in the controls output.
  </verify>
  <done>
    All control buttons use Tabler SVG icons (no emojis). Single-row controls layout with progress bar, skip ¬±10s, restart, time display, and close button. All CSS uses DWC custom properties with fallbacks. Build succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update spec and E2E tests for new controls, progress bar, and skip/restart</name>
  <files>
    src/components/sp-walkthrough/sp-walkthrough.spec.ts
    src/components/sp-walkthrough/sp-walkthrough.e2e.ts
  </files>
  <action>
    **Spec test updates:**
    Update existing tests that reference old emoji-based controls:
    - Tests checking for play/pause button text (`‚ñ∂`, `‚è∏`) should now check for SVG elements or aria-labels
    - Tests checking for prev/next buttons should verify skip-back-10 / skip-forward-10 buttons exist
    - Add tests for `handleSkipBack` ‚Äî verify it calls seekTo(currentTime - 10) or sets videoElement.currentTime, clamped to 0
    - Add tests for `handleSkipForward` ‚Äî verify it calls seekTo(currentTime + 10), clamped to duration
    - Add tests for `handleProgressClick` ‚Äî simulate click event on progress bar, verify seek to correct time
    - Add tests for `formatTime` ‚Äî verify `0` returns `"0:00"`, `65` returns `"1:05"`, `3661` returns `"61:01"`
    - Verify restart button calls `restart()` method
    - Verify no `.panel-header` element exists in rendered output (single-row layout)
    - Verify `.controls-row` or equivalent container exists
    - Verify SVG elements are present inside control buttons

    Follow established test patterns:
    - Use `page.rootInstance.methodName()` instead of `button.click()` to avoid Stencil worker crashes
    - Use `getAttribute('disabled')` for disabled state checks
    - No `jest.useFakeTimers()` before `await page.waitForChanges()` (blocks async resolution)

    **E2E test updates:**
    - Update selectors that relied on old controls structure
    - Verify controls row renders with expected buttons
    - Verify progress bar is visible when videoSrc is set
    - Verify skip/restart buttons trigger correct seeking behavior
  </action>
  <verify>
    Run `npx stencil test --spec --e2e` ‚Äî all tests pass.
    Run `npx stencil test --spec --coverage` ‚Äî sp-walkthrough coverage meets 70% threshold.
  </verify>
  <done>
    All spec and E2E tests pass. Tests cover Tabler SVG icon rendering, progress bar click-to-seek, skip ¬±10s, restart, single-row layout verification, and formatTime utility. No references to old emoji controls remain in tests. Coverage meets 70% threshold.
  </done>
</task>

</tasks>

<verification>
1. `npx stencil build` completes without errors
2. `npx stencil test --spec --e2e` ‚Äî all tests pass
3. No emoji characters (‚ñ∂, ‚è∏, ‚èÆ, ‚è≠, üîá, üîä, ‚úï) remain in sp-walkthrough.tsx controls output
4. All control buttons contain `<svg>` child elements
5. Progress bar div exists with click handler
6. Skip back, skip forward, and restart buttons are present in controls
7. Controls render in a single row (no separate panel-header above content)
8. All CSS properties use `var(--dwc-*, fallback)` pattern
</verification>

<success_criteria>
- All 6 requirements (WALK-01, WALK-02, WALK-03, WALK-04, WALK-10, WALK-11) are satisfied
- Build passes, all tests pass, coverage at or above 70%
- Controls match the expected single-row Tabler SVG icon design
</success_criteria>

<output>
After completion, create `.planning/phases/08-walkthrough-parity/08-01-SUMMARY.md`
</output>
