---
phase: 10-language-voice
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/sp-language-selector/types.ts
  - src/components/sp-language-selector/utils/languages.ts
  - src/components/sp-language-selector/utils/icons.tsx
  - src/components/sp-language-selector/sp-language-selector.tsx
  - src/components/sp-language-selector/sp-language-selector.css
  - src/components/sp-language-list/sp-language-list.tsx
  - src/components/sp-language-list/sp-language-list.css
  - src/index.html
autonomous: true
requirements: [LANG-01, LANG-02, LANG-03, LANG-04, LANG-05, LANG-06]

must_haves:
  truths:
    - "sp-language-selector renders as inline button with globe SVG icon, uppercase language code, and dropdown chevron arrow"
    - "Clicking the selector button opens sp-language-list as an animated slide-in dropdown via sp-popover"
    - "Language list shows a browser-preferred section at top and alphabetically sorted remaining languages below"
    - "Selecting a language emits a languageChange event with the language code and shows a checkmark next to the selected item"
    - "The language list auto-hides 3 seconds after the mouse leaves the dropdown"
    - "Both components support enabled/disabled state, compact mode, and dark theme via DWC variables"
  artifacts:
    - path: "src/components/sp-language-selector/types.ts"
      provides: "LanguageInfo interface, LanguageChangeEventDetail, shared type definitions"
    - path: "src/components/sp-language-selector/utils/languages.ts"
      provides: "Full language list data, getBrowserPreferredLanguages() utility"
    - path: "src/components/sp-language-selector/utils/icons.tsx"
      provides: "Tabler SVG icon helpers (globe, chevron-down, check) as TSX functions"
    - path: "src/components/sp-language-selector/sp-language-selector.tsx"
      provides: "Inline button component with globe icon, language code, dropdown arrow"
    - path: "src/components/sp-language-list/sp-language-list.tsx"
      provides: "Dropdown list with browser-preferred section, alphabetical sort, checkmark, auto-hide timer"
  key_links:
    - from: "src/components/sp-language-selector/sp-language-selector.tsx"
      to: "sp-popover"
      via: "Contains sp-popover in render, calls togglePopover() on button click"
      pattern: "<sp-popover"
    - from: "src/components/sp-language-selector/sp-language-selector.tsx"
      to: "sp-language-list"
      via: "Renders sp-language-list inside sp-popover slot"
      pattern: "<sp-language-list"
    - from: "src/components/sp-language-list/sp-language-list.tsx"
      to: "languageChange event"
      via: "Emits event on language selection with code payload"
      pattern: "this.languageChange.emit"
---

<objective>
Build sp-language-selector and sp-language-list as Stencil web components with shared types, language data, and browser-preferred language detection.

Purpose: Deliver the language selection UI — an inline button that opens an animated dropdown list showing browser-preferred languages first, then alphabetically sorted others, with checkmark indicators and auto-hide behavior.

Output: Two working Stencil components (sp-language-selector, sp-language-list), shared types, language data utility, SVG icon helpers, and CSS with DWC token theming.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-popover-utility/09-01-SUMMARY.md
@src/components/sp-popover/sp-popover.tsx
@src/components/sp-popover/types.ts
@src/components/sp-example/sp-example.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared types, language data utility, and SVG icon helpers</name>
  <files>
    src/components/sp-language-selector/types.ts
    src/components/sp-language-selector/utils/languages.ts
    src/components/sp-language-selector/utils/icons.tsx
  </files>
  <action>
Create the shared foundation for both language components:

**types.ts** — Define interfaces and types:
- `LanguageInfo` interface: `{ code: string; name: string; nativeName: string }` — represents a single language option
- `LanguageChangeEventDetail` interface: `{ code: string; name: string }` — event payload for language selection
- Export both interfaces

**utils/languages.ts** — Language data and browser detection:
- Export `LANGUAGES: LanguageInfo[]` — a comprehensive list of common languages (at least 20-25: en, es, fr, de, it, pt, nl, ru, zh, ja, ko, ar, hi, pl, sv, da, no, fi, cs, tr, el, he, th, vi, id). Each entry has code (ISO 639-1), English name, and native name (e.g. `{ code: 'de', name: 'German', nativeName: 'Deutsch' }`)
- Export `getBrowserPreferredLanguages(): string[]` — reads `navigator.languages` (with `navigator.language` fallback), extracts 2-letter codes (strip region suffixes like "en-US" → "en"), deduplicates, and returns codes that exist in the LANGUAGES array
- Export `getLanguageByCode(code: string): LanguageInfo | undefined` — lookup helper

**utils/icons.tsx** — Tabler SVG icon helpers as TSX functions (same pattern as sp-org-chart Phase 07 inline SVG icons):
- `renderGlobeIcon()` — Tabler globe icon (24x24 viewBox, stroke-based)
- `renderChevronDownIcon()` — Tabler chevron-down icon
- `renderCheckIcon()` — Tabler check icon (for selected language indicator)
- `renderMicrophoneIcon()` — Tabler microphone icon (for Plan 02 voice button)
- All icons accept optional `size?: number` parameter (default 18), use `currentColor` for stroke, `stroke-width="2"`, `stroke-linecap="round"`, `stroke-linejoin="round"`, `fill="none"`
  </action>
  <verify>
Build passes: `npx stencil build` exits 0. TypeScript compiles without errors. Verify types.ts exports LanguageInfo and LanguageChangeEventDetail. Verify languages.ts exports LANGUAGES array with 20+ entries, getBrowserPreferredLanguages function, and getLanguageByCode function. Verify icons.tsx exports all 4 icon render functions.
  </verify>
  <done>
Shared types, language data (20+ languages with codes and native names), browser language detection utility, and 4 SVG icon render functions all exist and compile cleanly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build sp-language-list dropdown component</name>
  <files>
    src/components/sp-language-list/sp-language-list.tsx
    src/components/sp-language-list/sp-language-list.css
  </files>
  <action>
Create the sp-language-list Stencil component — the dropdown panel that displays inside sp-popover.

**sp-language-list.tsx** — Stencil component with shadow DOM:

Props:
- `languages: LanguageInfo[]` — full language list (default: LANGUAGES from utility)
- `selectedLanguage: string` — currently selected language code (default: 'en')
- `preferredLanguages: string[]` — browser-preferred language codes (default: [] — parent will pass from getBrowserPreferredLanguages())
- `theme: 'light' | 'dark' | 'auto'` — DWC theme override (default: 'auto')
- `compact: boolean` — compact mode with smaller font/padding (default: false)

Events:
- `languageChange: EventEmitter<LanguageChangeEventDetail>` — emitted when user clicks a language item (LANG-03)

State:
- No complex internal state needed — rendering is purely from props

Render logic:
- Split `languages` into two groups: `preferredList` (codes in preferredLanguages, in order) and `othersList` (remaining, sorted alphabetically by `name`)
- If preferredList is non-empty, render a "Preferred" section header (styled muted label) followed by preferred items, then a thin separator `<hr>`, then "All Languages" section header and alphabetical list
- If preferredList is empty, just render the full alphabetical list
- Each language item renders as a clickable `<div class="language-item">` with: checkmark icon (visible only when code === selectedLanguage), language native name, language English name in parentheses (muted)
- On click: emit `languageChange` with `{ code, name }` payload

CSS parts: `container`, `section-header`, `language-item`

**sp-language-list.css** — DWC-themed styles:
- `:host` display: block
- `.language-list` — max-height: 300px; overflow-y: auto; min-width: 220px; padding: var(--dwc-spacing-xs) 0
- `.section-header` — font-size: var(--dwc-font-size-xs); color: var(--dwc-color-text-secondary); padding: var(--dwc-spacing-xs) var(--dwc-spacing-md); font-weight: var(--dwc-font-weight-semibold); text-transform: uppercase; letter-spacing: 0.05em
- `.language-item` — display: flex; align-items: center; gap: var(--dwc-spacing-sm); padding: var(--dwc-spacing-sm) var(--dwc-spacing-md); cursor: pointer; transition: background var(--dwc-transition-fast)
- `.language-item:hover` — background: var(--dwc-color-surface-secondary)
- `.language-item.selected` — color: var(--dwc-color-primary); font-weight: var(--dwc-font-weight-medium)
- `.check-icon` — width: 18px; flex-shrink: 0; visibility: hidden (visible when .selected)
- `.language-native` — font-size: var(--dwc-font-size-sm)
- `.language-english` — font-size: var(--dwc-font-size-xs); color: var(--dwc-color-text-secondary); margin-left: var(--dwc-spacing-xs)
- `.separator` — border: none; border-top: 1px solid var(--dwc-color-border); margin: var(--dwc-spacing-xs) 0
- Compact mode: `.compact .language-item` — padding: var(--dwc-spacing-xs) var(--dwc-spacing-sm); `.compact .language-native` — font-size: var(--dwc-font-size-xs)
- Theme overrides following :host(.theme-light) / :host(.theme-dark) pattern
  </action>
  <verify>
Build passes: `npx stencil build` exits 0. Component renders a scrollable list of languages. The language list is split into preferred and other sections when preferredLanguages prop has values. Clicking an item emits the languageChange event. The selected language shows a checkmark.
  </verify>
  <done>
sp-language-list renders a dropdown panel with browser-preferred section at top, alphabetically sorted others below, checkmark on selected item, and emits languageChange event on selection. DWC tokens used throughout with compact mode and theme overrides.
  </done>
</task>

<task type="auto">
  <name>Task 3: Build sp-language-selector inline button and wire dropdown via sp-popover</name>
  <files>
    src/components/sp-language-selector/sp-language-selector.tsx
    src/components/sp-language-selector/sp-language-selector.css
    src/index.html
  </files>
  <action>
Create the sp-language-selector Stencil component — the inline button that opens the language list dropdown.

**sp-language-selector.tsx** — Stencil component with shadow DOM:

Props:
- `selectedLanguage: string` — currently selected language code (default: 'en', mutable, reflect) (LANG-04)
- `disabled: boolean` — disables the button (default: false) (LANG-06)
- `compact: boolean` — compact display mode (default: false) (LANG-06)
- `theme: 'light' | 'dark' | 'auto'` — DWC theme override (default: 'auto') (LANG-06)
- `autoHideDelay: number` — ms before dropdown auto-hides after mouse leave (default: 3000) (LANG-05)

Events:
- `languageChange: EventEmitter<LanguageChangeEventDetail>` — bubbles up from sp-language-list selection (LANG-03)

State:
- `isOpen: boolean` — tracks dropdown open state
- `preferredLanguages: string[]` — computed once in componentWillLoad via getBrowserPreferredLanguages()

Element ref:
- `@Element() el: HTMLElement`

Private members:
- `popoverRef: HTMLSpPopoverElement | null` — ref to the sp-popover for calling togglePopover()
- `autoHideTimer: ReturnType<typeof setTimeout> | null` — for 3-second auto-hide (LANG-05)

Lifecycle:
- `componentWillLoad()`: call `getBrowserPreferredLanguages()` and store in `preferredLanguages` state. If `selectedLanguage` is not set and preferredLanguages has entries, keep 'en' default.

Methods:
- Private `handleButtonClick()`: if not disabled, call `this.popoverRef?.togglePopover()`. Clear any auto-hide timer.
- Private `handleLanguageSelected(event: CustomEvent<LanguageChangeEventDetail>)`: Update `selectedLanguage = event.detail.code`. Close the popover via `this.popoverRef?.hidePopover()`. Re-emit the languageChange event with same detail. Clear auto-hide timer.
- Private `handleMouseLeave()`: Start autoHideTimer — after `autoHideDelay` ms, call `this.popoverRef?.hidePopover()` (LANG-05)
- Private `handleMouseEnter()`: Clear autoHideTimer if running
- Private `handlePopoverOpen()`: set `isOpen = true`
- Private `handlePopoverClose()`: set `isOpen = false`, clear auto-hide timer

Cleanup:
- `disconnectedCallback()`: clear autoHideTimer

Render:
- Host with theme class + `onMouseLeave={handleMouseLeave}` + `onMouseEnter={handleMouseEnter}`
- A `<button>` with part="trigger" containing: `renderGlobeIcon()`, uppercase `selectedLanguage` text in a `<span class="lang-code">`, and `renderChevronDownIcon()` with a CSS rotation class when open
- `<sp-popover>` with `ref={el => this.popoverRef = el}`, `placement="bottom-start"`, `close-on-click`, `close-on-escape`, listening to `onPopoverOpen`/`onPopoverClose`
- Inside the popover slot: `<sp-language-list>` with `selectedLanguage`, `preferredLanguages`, `compact`, `theme` props passed through, listening to `onLanguageChange={handleLanguageSelected}`

**sp-language-selector.css** — DWC-themed styles:
- `:host` — display: inline-block; position: relative
- `.selector-button` — display: inline-flex; align-items: center; gap: var(--dwc-spacing-xs); padding: var(--dwc-spacing-xs) var(--dwc-spacing-sm); border: 1px solid var(--dwc-color-border); border-radius: var(--dwc-border-radius); background: var(--dwc-color-surface); color: var(--dwc-color-text); cursor: pointer; font-family: var(--dwc-font-family); font-size: var(--dwc-font-size-sm); transition: border-color var(--dwc-transition-fast), background var(--dwc-transition-fast)
- `.selector-button:hover` — border-color: var(--dwc-color-border-hover); background: var(--dwc-color-surface-secondary)
- `.selector-button:disabled` — opacity: 0.5; cursor: not-allowed; pointer-events: none
- `.selector-button.open` — border-color: var(--dwc-color-primary)
- `.lang-code` — font-weight: var(--dwc-font-weight-semibold); text-transform: uppercase; letter-spacing: 0.05em; min-width: 1.5em; text-align: center
- `.chevron` — transition: transform var(--dwc-transition-fast); display: flex; align-items: center
- `.chevron.open` — transform: rotate(180deg)
- Compact mode (`.compact .selector-button`): smaller padding and font
- Theme overrides: :host(.theme-light) / :host(.theme-dark) with appropriate surface/border overrides

**src/index.html** — Add a demo section for language selector after the Popover section:
- Section header "Language Selector"
- `<sp-language-selector id="langSelectorDemo"></sp-language-selector>`
- Event log div for languageChange events
- Script: listen to languageChange event and log to the div
  </action>
  <verify>
Build passes: `npx stencil build` exits 0. Open dev server (`npx stencil build --dev --watch --serve`), navigate to localhost:3333. The language selector button shows globe icon + "EN" + chevron. Clicking opens a dropdown via sp-popover showing language list. Selecting a language updates the button text and closes the dropdown. The languageChange event fires with the selected code.
  </verify>
  <done>
sp-language-selector renders as an inline button with globe icon, uppercase language code, and dropdown chevron. Clicking opens sp-language-list via sp-popover with browser-preferred section, alphabetical sort, checkmark, and auto-hide. All LANG-01 through LANG-06 requirements are met.
  </done>
</task>

</tasks>

<verification>
1. `npx stencil build` completes without errors
2. Both `sp-language-selector` and `sp-language-list` appear in docs.json with correct props, events
3. Dev server shows working language selector with dropdown that opens/closes
4. Language selection updates the button code text and emits languageChange event
5. Browser-preferred languages appear in a separate section at top of list
6. Dropdown auto-hides 3 seconds after mouse leaves
7. Disabled state prevents interaction; compact mode reduces sizing; theme overrides apply
</verification>

<success_criteria>
- sp-language-selector renders inline button with globe icon + uppercase code + chevron arrow (LANG-01)
- sp-language-list renders animated dropdown with preferred section + alphabetical sort (LANG-02)
- Selecting a language emits languageChange event with code (LANG-03)
- Selected language shows checkmark in list (LANG-04)
- List auto-hides after 3 seconds when mouse leaves (LANG-05)
- Both components support disabled, compact, and dark theme via DWC variables (LANG-06)
</success_criteria>

<output>
After completion, create `.planning/phases/10-language-voice/10-01-SUMMARY.md`
</output>
